{# ================================================================== #}
{# Shared Jinja macros — imported by _result_sections.html.          #}
{# ================================================================== #}


{# Format a duration in minutes as "X min mode" or "X hr Y min mode". #}
{% macro fmt_time(minutes, mode) %}{% set m = minutes | int %}{% if m >= 60 %}{{ m // 60 }} hr {{ m % 60 }} min {{ mode }}{% else %}{{ m }} min {{ mode }}{% endif %}{% endmacro %}


{# ── data_row ──────────────────────────────────────────────────────
   Unified data row component: label + detail + right-aligned value.

   Args:
     name:    Primary label (required). Supports safe HTML.
     detail:  Secondary line below label (optional).
     value:   Right-side text — typically formatted time (optional).
     variant: "place" | "hub" | "dimension" — controls spacing/border/align.
     no_border: If true, suppresses the bottom border (e.g., park highlight).

   For custom right-side content (progress bar, dual times), use {% call %}:

     {% call(slot) data_row(name="Green Space", variant="dimension") %}
       {% if slot == "right" %}<custom markup>{% endif %}
     {% endcall %}

   When called without {% call %}, `value` renders as plain .data-row__value.
   ── #}
{# ── score_ring ───────────────────────────────────────────────────────
   SVG ring showing the final score with band-coloured fill arc.

   Args:
     score:      Numeric score 0–100 (required).
     band_class: CSS class for band colouring, e.g. "band-exceptional".
     size_class: Wrapper CSS class controlling dimensions.
                 "score-ring-container" (main) or "rail-score-ring" (rail).
   ── #}
{% macro score_ring(score, band_class='', size_class='score-ring-container') %}
{% set pct = score / 100 %}
{% set circ = 251.33 %}
<div class="{{ size_class }} {{ band_class }}">
  <svg class="score-ring" viewBox="0 0 100 100">
    <circle class="score-ring-track" cx="50" cy="50" r="40"
            fill="none" stroke-width="8" />
    <circle class="score-ring-fill" cx="50" cy="50" r="40"
            fill="none" stroke-width="8"
            stroke-dasharray="{{ circ }}"
            stroke-dashoffset="{{ circ * (1 - pct) }}"
            stroke-linecap="round"
            transform="rotate(-90 50 50)" />
  </svg>
  <div class="score-ring-value">{{ score }}</div>
</div>
{% endmacro %}


{# ── safety_flags ─────────────────────────────────────────────────────
   Render safety-concern pills from presented_checks.

   Args:
     presented_checks: The result.presented_checks list.
     pill_class:       Extra CSS class on the wrapper div (optional).
   ── #}
{% macro safety_flags(presented_checks, pill_class='verdict-proximity-flags') %}
{% set safety_concerns = (presented_checks | default([])) | selectattr('category', 'equalto', 'SAFETY') | selectattr('result_type', 'ne', 'CLEAR') | list %}
{% if safety_concerns %}
<div class="{{ pill_class }}">
  {% for pc in safety_concerns %}
  <span class="verdict-proximity-pill proximity-{{ (pc.proximity_band or 'neutral') | lower }}">⚠ {{ pc.headline }}</span>
  {% endfor %}
</div>
{% endif %}
{% endmacro %}


{% macro data_row(name, detail=None, value=None, variant="hub", no_border=false) %}
<div class="data-row data-row--{{ variant }}{% if no_border %} data-row--no-border{% endif %}">
  <div class="data-row__info">
    <div class="data-row__name">{{ name }}</div>
    {% if detail is not none %}
      <div class="data-row__detail">{{ detail }}</div>
    {% endif %}
  </div>
  {% if caller %}
    <div class="data-row__right">
      {{ caller("right") }}
    </div>
  {% elif value is not none %}
    <div class="data-row__right">
      <span class="data-row__value">{{ value }}</span>
    </div>
  {% endif %}
</div>
{% endmacro %}
