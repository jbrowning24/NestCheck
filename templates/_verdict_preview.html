{% from '_macros.html' import data_row %}

<div class="landing-preview">
  <div class="landing-preview-label">Example Evaluation</div>
  <div class="report">
    {% set show_preview_score = preview_result.show_score if preview_result.show_score is defined else preview_result.passed_tier1 %}
    <div class="verdict-card{% if not show_preview_score %} score-failed{% endif %}">
      <div class="verdict-address">{{ preview_result.address }}</div>

      {% if show_preview_score %}
      {% set band_class = preview_result.score_band.css_class if preview_result.score_band is mapping else '' %}
      {% set band_label = preview_result.score_band.label if preview_result.score_band is mapping else (preview_result.score_band or preview_result.verdict) %}
      <div class="score-header">
        <div class="score-ring-container {{ band_class }}">
          {% set pct = preview_result.final_score / 100 %}
          {% set circ = 251.33 %}
          <svg class="score-ring" viewBox="0 0 100 100">
            <circle class="score-ring-track" cx="50" cy="50" r="40"
                    fill="none" stroke-width="8" />
            <circle class="score-ring-fill" cx="50" cy="50" r="40"
                    fill="none" stroke-width="8"
                    stroke-dasharray="{{ circ }}"
                    stroke-dashoffset="{{ circ * (1 - pct) }}"
                    stroke-linecap="round"
                    transform="rotate(-90 50 50)" />
          </svg>
          <div class="score-ring-value">{{ preview_result.final_score }}</div>
        </div>
        <div class="score-details">
          <div class="score-band {{ band_class }}">{{ band_label }}</div>
          <div class="score-scale">out of 100</div>
        </div>
      </div>
      {% endif %}

      {% if preview_result.dimension_summaries is defined and preview_result.dimension_summaries %}
      <div class="dimension-list">
        {% for dim in preview_result.dimension_summaries %}
        {% call(slot) data_row(name=dim.name, detail=dim.summary, variant="dimension") %}
          {% if slot == "right" %}
          <div class="dimension-indicator">
            <span class="dimension-score">{{ dim.score }}/{{ dim.max_score }}</span>
            <div class="dimension-bar">
              <div class="dimension-bar-fill" style="--fill: {{ ((dim.score / dim.max_score * 100) | int) if dim.max_score else 0 }}%"></div>
            </div>
          </div>
          {% endif %}
        {% endcall %}
        {% endfor %}
      </div>
      {% endif %}

      {% set safety_concerns = (preview_result.presented_checks | default([])) | selectattr('category', 'equalto', 'SAFETY') | selectattr('result_type', 'ne', 'CLEAR') | list %}
      {% if safety_concerns %}
      <div class="verdict-proximity-flags">
        {% for pc in safety_concerns %}
        <span class="verdict-proximity-pill proximity-{{ (pc.proximity_band or 'neutral') | lower }}">⚠ {{ pc.headline }}</span>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </div>

  <div class="landing-preview-cta">
    <a href="/s/{{ preview_snapshot_id }}">See the full report →</a>
  </div>
</div>
